<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
                      "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" 
      xml:lang="en" lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="eduComponents">

  <body>
    <metal:block fill-slot="css_slot">
      <style type="text/css" media="screen" tal:content="string: @import url($portal_url/ecabstyles.css);" />
    </metal:block>

    <metal:main fill-slot="main">
      <tal:main-macro metal:define-macro="main"
          define="global ecab_utils nocall: portal/ecab_utils;
                  permission        python: modules['AccessControl'].getSecurityManager().checkPermission;
                  isOwner           python: user.has_role(['Owner', 'Reviewer', 'Manager'], context);
                  isGrader          python: here.portal_membership.checkPermission('eduComponents: Grade Assignments', context);
                  finalStateValues  here/getFinalStateValues;
                  superseededStats  here/getSuperseededStats;
                  dateStats         here/getSubmissionDateStats;
                  "
                  
                  
      >
      
        <!--  debug -->
        <!-- 
        <div tal:content="python: 'showSuperseded:%s' % resFlt['show_superseded']" />
        <div tal:content="python: 'mkUrl:%s' % mkUrl({})" />
        <div tal:content="string: resFlt2:$resFlt2" />
        -->
      
        <div metal:use-macro="here/document_actions/macros/document_actions" />
    
        <div tal:define="global has_items python: 0;">
       
          <a class="link-parent visualNoPrint"
              tal:define="parent     python: here.aq_parent;
                          template   python: parent.getTypeInfo().getActionById(template_id, '');
                          parent_url python: here.navigationParent(here, fallThroughDefaultPage=False)"
              tal:condition="parent_url"
              tal:attributes="href python: '%s/%s' % (parent_url, template)"
              i18n:domain="plone"
              i18n:translate="go_to_parent_url">
            Up one level
          </a>

          <h4 i18n:translate="label_final_states"> Final states for all assignments</h4>
          <p tal:condition="python: finalStateValues[0] > 0">
              <tal:nothing define="statesDL here/getWfStatesDisplayList;"
                  repeat="state python: here.completedStates">
                      <span
                          tal:content="python: statesDL.getValue(state, default=state)"
                          tal:attributes="class python: 'state-' + putils.normalizeString(state)"
                          i18n:domain="plone"
                          i18n:translate=""
                      /><span tal:condition="not:repeat/state/end"
                      tal:replace="string:,"/>
              </tal:nothing>: 
              <span tal:replace="python: finalStateValues[1]" />
              (<span tal:replace="python: ecab_utils.localizeNumber('%.1f', float(100*finalStateValues[1]) / finalStateValues[0])" />%)
              <br />
              <span tal:omit-tag="" i18n:translate="Rejected">Rejected</span>:
              <span tal:replace="python: finalStateValues[2]" />
              (<span tal:replace="python: ecab_utils.localizeNumber('%.1f', float(100*finalStateValues[2]) / finalStateValues[0])" />%)
          </p>
          <p tal:condition="python: finalStateValues[0] <= 0">
              <span tal:omit-tag="" i18n:translate="No final Submissions">This ECFolder contains no Submissions in final states</span>
          </p><br />


          <h4 i18n:translate="label_superseeded_stats"> Total submissions per user</h4>

          <table class="listing" tal:condition="python: superseededStats[superseededStats[0]:]">
            <thead>
              <tr>
                <th i18n:translate="Submissions">Submissions</th>
                <th i18n:translate="Average submissions">Average submissions per assignment</th>
                <th i18n:translate="Submitters">Submitters</th>
                <th i18n:translate="Submitters per 100">Submitters (%)</th>
              </tr>
            </thead>

            <tbody style="text-align: right" tal:repeat="elem python: superseededStats[superseededStats[0]:]">
              <tr>
                <td tal:content="python: elem[0]"> 1 </td>
                <td tal:content="python: ecab_utils.localizeNumber('%.1f', float(elem[0]) / superseededStats[2])"> 1 </td>
                <td tal:content="python: elem[1]"> 1 </td>
                <td tal:content="python: ecab_utils.localizeNumber('%.1f', float(100 * elem[1]) / superseededStats[3])"> 1 </td>
              </tr>
            </tbody>
          </table>

          <p tal:condition="python: not superseededStats[superseededStats[0]:]">
              <span tal:omit-tag="" i18n:translate="No Submissions">No Submissions found at all</span>
          </p><br />


          <h4 i18n:translate="label_date_stats"> Submissions per date</h4>
          <table class="listing" tal:condition="python: dateStats">
            <thead>
              <tr>
                <th i18n:translate="label_date">Date</th>
                <th i18n:translate="Submissions">Submissions</th>
              </tr>
            </thead>
            <tbody style="text-align: right" tal:repeat="elem python: dateStats">
              <tr>
                  <td tal:content="python: here.toLocalizedTime(elem[0], False)"> 2007/01/23 </td>
                  <td tal:content="python: elem[1]"> 1 </td>
              </tr>
            </tbody>
          </table>
          <p tal:condition="python: not dateStats">
              <span tal:omit-tag="" i18n:translate="No Submissions">No Submissions found at all</span>
          </p><br />


        </div>
      </tal:main-macro>
    </metal:main>

  </body>
</html>
<!-- Keep this comment at the end of the file
Local variables:
mode:xml
sgml-local-catalogs:("/usr/local/lib/sgml/XHTML11.cat")
sgml-validate-command:"xmllint \\-\\-valid \\-\\-noout %s %s"
sgml-indent-step:2
sgml-indent-data:t
fill-column:79
End:
-->
