<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
                      "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en" metal:use-macro="here/main_template/macros/master"
      i18n:domain="eduComponents">
  <body>
    <metal:block fill-slot="css_slot">
      <style type="text/css" media="screen" 
          tal:content="string: @import url($portal_url/ecabstyles.css);" />
    </metal:block>

    <metal:main fill-slot="main">
      <tal:main-macro metal:define-macro="main">

        <div metal:use-macro="here/document_actions/macros/document_actions" />
    
        <h1 class="documentFirstHeading" tal:content="here/title"/>

        <a class="link-parent"
           tal:define="parent_url python:here.navigationParent(here, template_id)"
           tal:condition="parent_url"
           tal:attributes="href parent_url"
           i18n:domain="plone"
           i18n:translate="go_to_parent_url">
         Up one level
        </a>

        <div tal:define="
              global ecab_utils nocall:portal/ecab_utils;
              auth_filter   nocall: modules/ZTUtils/LazyFilter;
              default_types python: here.allowed_content_types;
              types         types | here/show_content_types | default_types;
              raw_items     python: here.contentValues(filter={'portal_type': types });
              items         python: auth_filter(raw_items, skip='View');"
          tal:condition="items">
     
          <table class="listing">
            <thead>
              <tr>
                <th i18n:translate="label_date">Date</th>
                <th i18n:translate="label_user">User</th>
                <th i18n:translate="label_state">State</th>
                <th i18n:translate="label_mark">Grade</th>
                <th i18n:translate="label_actions">Actions</th>
              </tr>
            </thead>
        
            <tbody>
              <tal:block tal:repeat="item items">
      	        <tr tal:condition="python: ecab_utils.isAssignmentBoxType(item)"	        
      	            tal:define="oddrow              repeat/item/odd;
              	                item_type           item/portal_type;
              	                item_wf_state       item/review_state | python: wtool.getInfoFor(item, 'review_state', '');
              	                item_state_title    python: wtool.getTitleForStateOnType(item_wf_state, item_type);
              	                item_wf_state_class python: 'state-' + putils.normalizeString(item_wf_state);"
                    tal:attributes="class python: test(oddrow, 'odd', 'even')">
      
                  <td>
                	  <span tal:replace="python: here.toPortalTime(item.CreationDate(), 1)" />
                  </td>
      
                  <td tal:content="python: ecab_utils.getFullNameById(item.Creator())"/>
      
                  <td>
                    <span i18n:domain="plone"
                        i18n:translate=""
                        tal:condition="item_state_title"
                        tal:content="item_state_title"
                        tal:attributes="class item_wf_state_class" />
                    <span tal:condition="not: item_state_title">&nbsp;</span>
                  </td>
      
                  <td style="text-align: right">
                    <span tal:condition="python: (item_wf_state == 'graded') and (item.getMark())"
                        tal:content="item/mark"/>
                  </td>
      
                  <td>
                    <a href="item_url"
                        tal:attributes="href python: '%s/%s' % (item.getId(), item.getTypeInfo().getActionById('view'))"
                        i18n:translate="label_action_view">[View]</a>
      
                    <tal:block 
                        tal:define="permission python: modules['AccessControl'].getSecurityManager().checkPermission;
                                    isReviewer python: bool(permission('Review portal content', here));"
                        tal:condition="python: isReviewer">
                      <a href="item_url"
                          tal:attributes="href python: '%s/%s' % (item.getId(), item.getTypeInfo().getActionById('grade'))"
                          i18n:translate="label_action_grade">
                        [Grade]
                      </a>
                    </tal:block>
      
                  	<a href="item_url"
                  	    tal:attributes="href python: '%s/at_download/file' % (item.getId(),)"
                  	    i18n:translate="label_action_download">[Download]</a>
                  </td>
                </tr>
              </tal:block>
            </tbody>
          </table>
        </div>
    
        <div metal:use-macro="here/document_byline/macros/byline" />

      </tal:main-macro>
    </metal:main>

  </body>
</html>
<!-- Keep this comment at the end of the file
Local variables:
mode:xml
sgml-local-catalogs:("/usr/local/lib/sgml/XHTML11.cat")
sgml-validate-command:"xmllint \\-\\-valid \\-\\-noout %s %s"
sgml-indent-step:1
sgml-indent-data:t
fill-column:79
End:
-->
