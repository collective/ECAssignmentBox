<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
                      "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en"
 metal:use-macro="here/main_template/macros/master"
 i18n:domain="eduComponents">

 <body>
  <metal:block fill-slot="css_slot">
   <link rel="stylesheet" type="text/css" href="ecabstyles.css"/>
  </metal:block>

  <metal:main fill-slot="main">
   <tal:main-macro metal:define-macro="main">

    <div metal:use-macro="here/document_actions/macros/document_actions">
     Document actions (print, sendto, etc.)
    </div>
    
    <h1 class="documentFirstHeading"
     i18n:translate="label_submissions">Submissions</h1>

    <div tal:define="
     auth_filter   nocall: modules/ZTUtils/LazyFilter;
     default_types python:('ECAssignmentBox', 'ECAssignmentBoxQC');
     types         types | here/show_content_types | default_types;
     raw_items     python: here.contentValues(filter={'portal_type': types});
     items         python: auth_filter(raw_items, skip='View');"
     tal:condition="items">
     
    <tal:block tal:repeat="item items">
     <div tal:define="item_wf_state item/review_state | python: wtool.getInfoFor(item, 'review_state', '');"
      tal:condition="python: (item_wf_state == 'published')">

      <h3>
       <a href="item_url"
	tal:attributes="
	href python: '%s/%s' % (item.getId(), item.getTypeInfo().getActionById('view'))"
	tal:content="item/title"/>
      </h3>

      <table class="listing">
       <thead>
	<tr>
	 <th i18n:translate="label_date">Date</th>
	 <th i18n:translate="label_user">User</th>
	 <th i18n:translate="label_state">State</th>
	 <th i18n:translate="label_mark">Grade</th>
	 <th i18n:translate="label_actions">Actions</th>
	</tr>
       </thead>

       <tbody tal:define="summary item/getAssignmentsSummary;
	wtool here/portal_workflow;">
	<tal:block tal:repeat="assignment summary">
	 <tr tal:define="oddrow repeat/assignment/odd;
	  wf_state_class python: 'state-' + putils.normalizeString(wtool.getInfoFor(assignment, 'review_state', ''));"
	  tal:attributes="class python: test(oddrow, 'odd', 'even')">
	  <td tal:content="python: here.toPortalTime(assignment.getDatetime(), True)"/>
	  <td tal:content="python: assignment.getCreatorFullName()">
	  </td>
	  <td>
	   <span tal:content="python: wtool.getInfoFor(assignment, 'review_state', '')"
	    tal:attributes="class wf_state_class"/>
	  </td>
	  <td>
	   <span tal:content="python: assignment.getMark()"/>
	  </td>
	  <td>
	   <a href="item_url"
	    tal:attributes="href python: assignment.reference_url()"
	    i18n:translate="label_action_view">[View]</a>
	  </td>
	 </tr>
	</tal:block>
       </tbody>

      </table>
     </div>
    </tal:block>
   </div>

   </tal:main-macro>
  </metal:main>

 </body>
</html>
<!-- Keep this comment at the end of the file
Local variables:
mode:xml
sgml-local-catalogs:("/usr/local/lib/sgml/XHTML11.cat")
sgml-validate-command:"xmllint \\-\\-valid \\-\\-noout %s %s"
sgml-indent-step:1
sgml-indent-data:t
fill-column:79
End:
-->
