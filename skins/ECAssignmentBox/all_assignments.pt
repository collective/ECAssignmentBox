<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
                      "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" 
      xml:lang="en" lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="eduComponents">

  <body>
    <metal:block fill-slot="css_slot">
      <style type="text/css" media="screen" tal:content="string: @import url($portal_url/ecabstyles.css);">
      </style>
    </metal:block>

    <metal:main fill-slot="main">
      <tal:main-macro metal:define-macro="main"
          define="userName request/userName | nothing;
              permission python: modules['AccessControl'].getSecurityManager().checkPermission;
              isReviewer python: bool(permission('Review portal content', here));">

        <div metal:use-macro="here/document_actions/macros/document_actions" />
    
        <div tal:define="global ecab_utils nocall:portal/ecab_utils;
                n_boxes python: here.countContainedBoxes();">

<!--
                auth_filter nocall: modules/ZTUtils/LazyFilter;
                searchMembers nocall: mtool/searchMembers;
                default_types python: here.allowed_content_types;
                types types | here/show_content_types | default_types;
                raw_items python: here.contentValues(filter={'portal_type': types});
                items python: auth_filter(raw_items, skip='View');"
            tal:condition="items">
-->

          <metal:use use-macro="here/base_macros/macros/all_assignments_heading" />

          <metal:use use-macro="here/base_macros/macros/user_details" />

          <p>
            <span i18n:translate="label_n_boxes">
              Published assignment boxes inside this folder:
            </span>  
            <span tal:omit-tag="" tal:content="n_boxes"/>
          </p>

          <!-- start showing folder title and items -->
          <tal:contain define="location nocall:here; level python:1;">
            <div tal:attributes="class item_type_class"
                 tal:define="
                   item_type here/portal_type;
                   item_type_class python: 'contenttype-' + normalizeString(item_type);">
              <h4 class="visualIconPadding" tal:content="here/pretty_title_or_id"/>
            </div>
            <div metal:use-macro="template/macros/list" /> 
          </tal:contain> 

          <tal:hidemacro replace="nothing">
            <metal:recurse define-macro="list">

              <div tal:repeat="elt location/objectValues">
                <tal:block 
                    define="item_wf_state elt/review_state | python: wtool.getInfoFor(elt, 'review_state', '');"
                    condition="python: (item_wf_state == 'published')">

                  <metal:recurse 
                      tal:condition="elt/isPrincipiaFolderish"
                      tal:define="
                        location            nocall: elt;
                        level               python: level + 1;
                        use_view_action     site_properties/typesUseViewActionInListings;
                        item_url            elt/getURL|elt/absolute_url;
                        item_wf_state_class python: 'state-' + normalizeString(item_wf_state);
                        item_title_or_id    elt/pretty_title_or_id;
                        item_type           elt/portal_type;
                        item_type_class     python: 'contenttype-' + normalizeString(item_type);"
                  >

                    <div class="visualIconPadding">
                      <span tal:attributes="class item_type_class"
                          tal:condition="python:item_type != 'Link'">
                        <a href="#" 
                           tal:attributes="href python:test(item_type in use_view_action, item_url+'/view', item_url+'/');
                           class string:$item_wf_state_class visualIconPadding;
                           title elt/description|nothing"
                           tal:content="item_title_or_id"/>
                      </span>

                      <div metal:use-macro="template/macros/list"/>

                      <hr tal:condition="python: elt.portal_type == 'ECFolder'" />
                    </div>
                  </metal:recurse>

                  <table class="listing"
                      tal:condition="python: ecab_utils.isAssignmentBoxType(elt)">

                    <metal:use use-macro="here/base_macros/macros/all_assignments_thead" />

                    <tal:block define="
                        items python: elt.getAssignmentsSummary(id=userName);
                        wtool here/portal_workflow;">

                      <metal:use use-macro="here/base_macros/macros/all_assignments_tbody" />
                    </tal:block>

                  </table>
                </tal:block>
              </div>

            </metal:recurse>
          </tal:hidemacro>
          <!-- end list items -->

        </div>
      </tal:main-macro>
    </metal:main>

  </body>
</html>
<!-- Keep this comment at the end of the file
Local variables:
mode:xml
sgml-local-catalogs:("/usr/local/lib/sgml/XHTML11.cat")
sgml-validate-command:"xmllint \\-\\-valid \\-\\-noout %s %s"
sgml-indent-step:2
sgml-indent-data:t
fill-column:79
End:
-->
