<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
                      "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" 
      xml:lang="en" lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="eduComponents">

  <body>
    <metal:block fill-slot="css_slot">
      <style type="text/css" media="screen" 
          tal:content="string: @import url($portal_url/ecabstyles.css);" />
    </metal:block>

    <metal:main fill-slot="main">
      <tal:main-macro metal:define-macro="main"
          define="userName request/userName | nothing;
              ecab_utils    nocall: portal/ecab_utils;
              permission    python: modules['AccessControl'].getSecurityManager().checkPermission;
              isReviewer    python: bool(permission('Review portal content', here));">

        <div metal:use-macro="here/document_actions/macros/document_actions" />
    
        <metal:use use-macro="here/base_macros/macros/all_assignments_heading" />

        <a class="link-parent"
            tal:define="parent_url python:here.navigationParent(here, template_id)"
            tal:condition="parent_url"
            tal:attributes="href parent_url"
            i18n:domain="plone"
            i18n:translate="go_to_parent_url">
          Up one level
        </a>
        
        <metal:use use-macro="here/base_macros/macros/user_details" />

        <div tal:define="
          	  auth_filter   nocall: modules/ZTUtils/LazyFilter;
          	  default_types python: here.allowed_content_types;
          	  types         types | here/show_content_types | default_types;
          	  raw_items     python: here.contentValues(filter={'portal_type': types});
          	  items         python: auth_filter(raw_items, skip='View');
          	  grades        here/getNumericGrades;
              tabindex      python: Iterator();"
            tal:condition="items">

        <form action=""
            method="post"
            name="allAssignmentsEditForm"
            tal:attributes="action string:${here/absolute_url}/${template/getId}">

          <table class="listing">

            <metal:use use-macro="here/base_macros/macros/all_assignments_thead" />

            <metal:use use-macro="here/base_macros/macros/all_assignments_tbody" />

      	    <tfoot tal:condition="grades">
              <tr>
            		<td colspan="4"
            		  i18n:translate="label_average_grade">Average Grade</td>
            		<td
            		  style="text-align: right"
            		  tal:content="python: ecab_utils.localizeNumber('%.2f',
            		  ecab_utils.calculateMean(grades))"/>
            		<td/>
            	</tr>
              <tr>
            		<td colspan="4"
            		  i18n:translate="label_median_grade">Median Grade</td>
            		<td
            		  style="text-align: right"
            		  tal:content="python: ecab_utils.localizeNumber('%.2f',
            		  ecab_utils.calculateMedian(grades))"/>
            		<td/>
              </tr>
            </tfoot>

          </table>

	        <p tal:condition="grades"
	            i18n:translate="grade_statistics_help" class="discreet">
	          Average and median grades are calculated from all assignments
	          in this assignment box which are in the state <em>graded</em> and
	          which have a grade assigned.
	        </p>


          <div class="formControls" tal:condition="python: isReviewer">

            <select name="workflow_action" size="1"
                 tal:attributes="tabindex tabindex/next;"
                 tal:define="transitions here/ecab_utils/getWfTransitionsDisplayList">
              <option tal:repeat="key python:transitions.keys()"
  	              tal:content="python: transitions.getValue(key)"
      	          tal:attributes="value key"
              	  i18n:domain="plone"
                	i18n:translate="">
            	  Transition Name
              </option>
            </select>

            <input class="context"
                   type="submit"
                   name="form.button.Change"
                   value="Change State"
                   tabindex=""
                   i18n:domain="plone"
                   i18n:attributes="value"
                   tal:attributes="tabindex tabindex/next;"
            />

            <input type="hidden" name="form.submitted" value="1" />
          </div>

        </form>

        </div>
   
        <div metal:use-macro="here/document_byline/macros/byline" />

      </tal:main-macro>
    </metal:main>

  </body>
</html>
<!-- Keep this comment at the end of the file
Local variables:
mode:xml
sgml-local-catalogs:("/usr/local/lib/sgml/XHTML11.cat")
sgml-validate-command:"xmllint \\-\\-valid \\-\\-noout %s %s"
sgml-indent-step:2
sgml-indent-data:t
fill-column:79
End:
-->
